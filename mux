#!/bin/zsh
# mux - tmuxinator wrapper with enhanced commands

SCRIPT_DIR="${0:A:h}/tmuxinator_scripts"
PYTHON="/opt/homebrew/Caskroom/miniconda/base/bin/python"

if [[ "$1" == "ddl" ]]; then
  # Check if --linear flag is present
  if [[ "${@:2}" == *"--linear"* ]]; then
    # Use old Ruby version
    "$SCRIPT_DIR/tmuxinator-ls-ddl" $(echo "${@:2}" | sed 's/--linear//')
  else
    # Use new Textual Python version (default)
    "$PYTHON" "$SCRIPT_DIR/tmuxinator-ls-ddl.py" "${@:2}"
  fi
elif [[ "$1" == "new" ]]; then
  "$SCRIPT_DIR/tmuxinator-new" "${@:2}"
elif [[ "$1" == "archive" ]]; then
  "$SCRIPT_DIR/tmuxinator-archive" "${@:2}"
elif [[ "$1" == "summary" ]]; then
  "$PYTHON" "$SCRIPT_DIR/tmuxinator-summary.py" "${@:2}"
elif [[ "$1" == "" ]] || [[ "$1" == "-h" ]] || [[ "$1" == "--help" ]]; then
  echo "mux - tmuxinator wrapper with enhanced commands"
  echo ""
  echo "Enhanced commands:"
  echo "  mux ddl              - Show interactive Eisenhower matrix dashboard"
  echo "  mux ddl --linear     - Show classic linear list view"
  echo "  mux new <name>       - Create new project from template (DDL: 7 days)"
  echo "  mux archive <name>   - Archive project to ~/.config/tmuxinator-backups"
  echo "  mux summary          - Show progress summary for all projects"
  echo ""
  echo "Standard commands (run 'mux help' for full list):"
  tmuxinator help
else
  tmuxinator "$@"
fi
